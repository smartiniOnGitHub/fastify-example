# fastify-example - TODO

## TODO

* [x] general: setup some automation to make builds via GitHub Actions and maybe publish there images (but only after a tag, at least trigger them manually) and if possible even latest; update README with some badge or at least some links ... wip 

* [x] general: re-enable my plugins once compatible with fastify 3.x: 'fastify-nats-client' ... done (and re-enabled related feature in my local '.env' file, to disable after all this stuff will work again), but related code (references to NTS items exposed by the plugin, connection options, etc) and publish/subscribe functions defined here must be updated to support NATS 2.x features (encode/decode, all async, etc) ... wip
* [x] general: re-enable my plugins once compatible with fastify 3.x: 'fastify-cloudevents' ... wip
* [x] general: update 'snky' package (and related npm custom commands) to the new one, see: [@snyk/protect - npmjs](https://www.npmjs.com/package/@snyk/protect) ... wip
* [x] general: other improvements for first release compatible with Fastify 3.x ... wip

* [x] content: update favicon to modern practices (by default add an svg version and manage dark theme, and keep 'favicon.ico' only as fallback, etc); sor example look [here](https://css-tricks.com/svg-favicons-and-all-the-fun-things-we-can-do-with-them/), [here](https://evilmartians.com/chronicles/how-to-favicon-in-2021-six-files-that-fit-most-needs), etc ... wip
* [x] content: add a property 'user' to requests, in the right (fast) way for Fastify, like: `fastify.decorateRequest('user', null)`; so the underlying Node.js engine (V8) will optimize requests that will have that field updated (later, when a user will be logged) ... wip
* [x] content: add a Login page ('/login') and related Logout page ('/logout'), to implement a simple login/logout flow, then expose some resources (for example all under '/private' or '/user' or '/user/info') only to a logged user; but keep this feature always enabled (no feature flag for this, at least now); and enable the link to it in navigation bar ... wip
* [x] general: fastify-jwt: now (like other parts in this webapp) enable it with a feature flag, and implement a simple login/logout flow, with access to at least 1 route only for logged users (to simplify things maybe generate a random password for an administrator at webapp startup); manage form url-encoded data with 'fastify-formbody' (already added here to dependencies, but need to be enabled/registered at webapp startup) ... wip

* [x] general: update all dependencies to latest ... wip
* [x] general: define json schema for all exposed endpoints here, as seen in [Validation-and-Serialization - Fastify](https://github.com/fastify/fastify/blob/master/docs/Validation-and-Serialization.md), useful even to improve performances ... wip
* [x] content: update css code to work in the right way even in other languages (different directions, etc), as seen for example [here](https://web.dev/centering-in-css/); so improve existing styles that uses Flex Box and maybe add others using Flex Grid (now well supported everywhere) maybe to set as default ... wip
* [x] content: cleanup code related to the info uri ('/info/all', '/info/app', '/info/scm', '/info/os') by moving in a related plugin, and use it from here in the simple way; but add a feature flag to enable them ... wip
* [x] content: as a sample, add customizations to current styles with a theme css file (one or more) ... so move in a dedicated theme some styles/colors/etc currently not used (but of course not structural definitions) and use it to override normal styles (for example new ocean related colors) ... wip

* [ ] general: update syntax to Node.js 12 LTS or better to 14 LTS, to be able to use all the new (great) stuff like Class properties (public and private) etc ...
* [ ] general: check if split main server in: server creation and server start, to be able to reuse server creation even in tests and inject calls in it; for example see 'fastify-starter' at [CodeSandbox](https://codesandbox.io) ...
* [ ] general: check if use modules since Node.js 12 LTS but from 12.22.0, as seen [here](https://nodejs.org/en/blog/release/v12.22.0/) ... better, wait and use Node.js 14 LTS, but at the moment don't switch to ESM modules (do it later) ...
* [ ] general: update code like this great example using ESM: [fastify-101 - delvedor - github](https://github.com/delvedor/fastify-101) ... wip

* [ ] content: add something protected by authentication; maybe here start with something really simple, with some fixed user/group/role, but defined via env ('fastify-env'), not hardcoded in code ... trick: let Fastify optimize request prototype object by decarating the request with a `null` object to represent the user (and the same for other properties in this case), so something like: `fastify.decorateRequest('user', null)` ...
* [ ] content: add other routes, but in a dedicated source (or folder) ...
* [ ] content: add error handlers ...
* [ ] content: cleanup/update to latest standards my custom styles ...
* [ ] content: start to use [marko](https://markojs.com/), but in a branch (to merge later info master, and before it, create a maintanance branch for ejs); note that the new plugin '@marko/fastify' must be used, and remove 'point-of-view' (no more useful at that point); see [@marko/fastify - npmjs](https://www.npmjs.com/package/@marko/fastify) ...

* [ ] general: later update to Node.js 16 LTS (16.13.0) and so output ES2022/ES13 or at least ES2021/ES12; ensure to expose all only as ES Modules (ESM), no more CommonJS ...


---------------


## DONE

* [x] general: create/update initial skeleton (from an existing example) and tag it in git ... ok
* [x] general: update dependencies/devDependencies etc in 'package.json', references to my remote repository, etc ... ok
* [x] general: update the sample code with my standards (formatting, port 8000 for the dev server, etc) ... ok
* [x] general: add License header in all source files ... ok
* [x] general: update to Fastify 1.0.0 (just released), and related plugins, to ensure all work ... ok, done and tested
* [x] general: update README to add reference to Dockerfile-usage ... ok
* [x] general: add a precommit hook that trigger tests before a git commit ... maybe later

* [x] content: add some simplified sources and resources (templates, pages, etc), to use as a base (and example) for others ... ok
* [x] content: add 'nodemon' in devDependencies to be able to reload all content (even sources) in DEV environment ... ok
* [x] content: printing routes at server startup, but only for non production environments ... ok

* [x] example: use fastify options to change log level, etc ... ok
* [x] example: use the 'fastify-favicon' plugin, to test it ... done (in page, still not in tests), but when calling [favicon.ico - localhost 8000](http://localhost:8000/favicon.ico) still it doesn't return the requested resource (should be published by the plugin)... ok, needed to update to a newer release of the plugin ('0.1.1')
* [x] example: tag initial release (but without changing release number in 'package.json') ... ok
* [x] example: use the 'fastify-webhook' plugin, to test it ... but for now don't add specific unit tests here ... ok
* [x] example: test 'fastify-webhook' plugin, even from a CLI tool like curl, for example run the server with: `npm start` and check with a Browser that the [Home page](http://localhost:8000) is reachable; then in another terminal do: `curl http://127.0.0.1:8000/webhook -X POST -H "Content-Type: application/json" -d '{"payload":"test"}'` => returning a JSON response (maybe in this case a dump of the given data), and no error thrown ... yes but maybe it would be better to have another example server script ... done, but note that on Windows I need to do the curl call in this way (in the json data using a double quote but escaping it in json fields), so: `curl http://127.0.0.1:8000/webhook -X POST -H "Content-Type: application/json" -d "{\"payload\":\"test\"}"`; check if I could move that data in a file (for example 'body.json') and point to it with: `curl http://127.0.0.1:8000/webhook -X POST -H "Content-Type: application/json" -d @body.json` not only for Windows; expected response: `{"statusCode":200,"result":"success"}` ... ok
* [x] example: update usage of 'fastify-webhook' plugin, to better test it, but keep previous code commented (for a minimal sample usage) ... ok, so now try to call it for example with (from Windows): `curl http://127.0.0.1:8000/custom-webhook -X POST -H "Content-Type: application/json" -d "{\"payload\":\"test\"}"`, otherwise remove the escape of double quote chars and keep the rest for Linux/Mac: `curl http://127.0.0.1:8000/custom-webhook -X POST -H "Content-Type: application/json" -d '{"payload":"test"}'`

* [x] general: update to latest (post-1.0.x) stable Fastify ... ok, so for now use '^1.2.1'

* [x] general: update npm custom commands to run unit tests to not call 'standard' directly, but to call its custom task 'lint' defined in this project ... ok, done; note that calling only 'standard' (but always better to call the local installation of it) without arguments let it scan all folders in the project, so in this case passing the list of folders/subfolders to scan should be better/faster
* [x] general: like in Fastify (and its core plugins), check if remove the dev dependency on 'request', and instead use 'simple-get' ... changed, now update all tests ... ok, done; but improve later all tests here
- general: add a dependency on [is-docker](https://www.npmjs.com/package/is-docker), to change (in the server script) the listening address to '0.0.0.0' when in Docker, as in [fastify-cli - Fastify](https://github.com/fastify/fastify-cli); anyway the change to replicate in this project is shown [here](https://github.com/fastify/fastify-cli/commit/0d581c474bd6c7ade5c292decf5fe1062c1e5e03) ... added in dependencies, but need to use it now ... ok, done
* [x] general: check if use [fast-json-stringify - Fastify](https://github.com/fastify/fast-json-stringify) to generate (and maybe even validate) output in JSON; should be faster that 'JSON.stringify' ... try to use it in some function in the 'utils.js' module ... added in dependencies ... ok, but use later in utils
* [x] general: like in Fastify (and its core plugins), check if remove the dev dependency on 'request', and instead use 'simple-get' ... changed, now update all tests ... ok, done; but improve later all tests here
* [x] general: check if empty peerDependencies and move them under devDependencies in 'package.json'; for more info see even [peer-dependencies - node.js](https://nodejs.org/en/blog/npm/peer-dependencies/) ... try removing 'request' from dev dependencies and (like other Fastify core plugin) use 'simple-get'; but first try emptying peerDependencies, from: '''
"ajv": "^5.0.0",
"eslint-plugin-import": "^2.8.0",
"eslint-plugin-promise": "^3.6.0",
"eslint-plugin-react": "^7.6.1"
 ''' ... ok, and all tests seems to run well
* [x] general: in the example, use latest version of my 'fastify-favicon' plugin ('0.2.1'), to test it ... ok
* [x] general: after latest updates (as of today, 2018-04-13), check why the response for any page is very very slow, urgent ... note that even after a manual cleanup of 'node_modules' folder and redo an 'npm install' nothing changed; but it I open Browser Developer Console all seems to be good (both in latest Firefox and Chrome); check with Fastify guys, urgent ... not sure it's a bug, so for now I just opened an help request [here](https://github.com/fastify/help/issues/9) ... now check as suggested, and then maybe debug 'fastify-static' ... no wait, probably the issue is this: [issue#50 - fastify-static](https://github.com/fastify/fastify-static/issues/50) and maybe even [issue#23 - node-fastify-auto-push](https://github.com/google/node-fastify-auto-push/issues/23) even if not strictly related to my usage; so wait for the fix and a new release of 'fastify-static' to test ... ok, with '0.10.1' the problem is resolved
* [x] general: update to latest Fastify 1.3.0 (just released) and related plugins, to ensure all work ... ok, done and tested
* [x] general: update to latest Fastify 1.4.0 (just released) and related plugins, to ensure all work; then update CHANGELOG, commit and tag ... ok
* [x general: start to move to ES Modules, enabled since Node.js 10 as seen [here](https://levelup.gitconnected.com/whats-new-in-node-10-ad360ae55ee4); look [here](https://medium.com/@giltayar/native-es-modules-in-nodejs-status-and-future-directions-part-i-ee5ea3001f71) for an overview ... do only some trivial changes accordingly to [package.json - npmjs](https://docs.npmjs.com/files/package.json) ... maybe later do more
* [x] general: update npm custom commands to use local installed tools via [npx](https://www.npmjs.com/package/npx) ... note that should already be installed with latest npx, but if not (sometimes in Windows) install with `npm install -g npx`, then check with `npx --version` ... no, because as seen [here](https://michael-kuehnel.de/tooling/2018/03/22/helpers-and-tips-for-npm-run-scripts.html), npx can't run npm custom commands but instead is made for run local tools; anyway, simplify 'package.json' to remove './node_modules/.bin/' from any custom command, and (recommended) remove those (and in general any if possible) global npm packages
* [x] general: update the example (and first the test) to show a sample with custom options, and let it work with a sample 'favicon.ico' (16x16) generated with GIMP ... note that it seems that there is a problem in 'fastify-favicon' with custom path (both absolute and relative to server script); check from the 'temp' folder with `wget http://localhost:8000/favicon.ico --no-cache` (or similar with 'curl') and then open generated file to ensure it's the custom favicon; then update changelog, release number, etc ...  ok, but no issue raised because it was due to a wrong path given; so updated readme and the example
* [x] general: update all core dependencies on Fastify and related plugins ... ok
* [x] general: run all even with Node.js 10.x.x, to check if everything works (as should) ... ok, all works even with Node.js 10.1.0
* [x] example: update 'fastify-webhook' to latest version ... ok

* [x] general: check licenses of dependencies, for example with [legally - npm](https://www.npmjs.com/package/legally) or with [license-checker - npm](https://www.npmjs.com/package/license-checker); then repeat after some time ... ok, used 'legally' but run via npx, all seems to be good
* [x] general: update to latest Fastify (1.7.0), and update diagnostic code on the listening address and port using the new syntax ... ok
* [x] general: change all references to js sources by removing its '.js' explicit extension, to be more future proof for using Node.js modules ('.mjs') since Node.js 10 ... ok, done in 'package.json' commands and even when using 'handlers' from 'fastify-webhook' for example

* [x] general: update sample docker-related files with some best practices, as seen [here](https://nodesource.com/blog/containerizing-node-js-applications-with-docker/) and [here](https://github.com/nodejs/docker-node/blob/master/docs/BestPractices.md) ... ok, mostly implemented, but for some (secondary)maybe later; note that standard image is big and not optimized for size (and I dediced even to install there npm packages for dev/non-production), but in the alpine based image not (it's much smaller and only npm packages for production environment are installed)
* [x] general: add some example route to use the async/await syntax, as seen in [Fastify goes LTS with 1.0.0 - Medium](https://medium.com/@fastifyjs/fastify-goes-lts-with-1-0-0-911112c64752) ... maybe later

* [x] example: use the 'fastify-cloudevents' plugin, to test it (configure it for a common usage scenario, and add a /time route) ... but for now don't add specific unit tests here ... ok, even if 'loggingCallback' does some noise (additional output for the dump of related Cloudevents) in the console

* [x] general: change template engine from 'ejs' to [Nunjucks](https://mozilla.github.io/nunjucks/) or [Marko](https://markojs.com), but in a branch (and merge later into master) ... maybe later, or in another repository
* [x] example: update 'point-of-view' to latest version (when published) ... ok
* [x] general: update all core dependencies on Fastify and related plugins ... ok, and often repeat this task
* [x] example: add some minimal unit test to ensure published routes are available (at least that for the home page), using  'simple-get' (already available in devDependencies); and that some are no more available (default webhook url for example, but that the new one it is) ... maybe later
* [x] general: in the branch 'add-fastify-nats', use my fork of 'fastify-nats', with its temporary name 'fastify-nats-client' and ensure all is good; but do not merge those changes into master ... ok
* [x] general: update dependencies to latest Fastify 1.x (1.13.1) and all plugins ... ok
* [x] general: in the branch 'add-fastify-nats', revert the use of 'fastify-nats-client' and use the new version of 'fastify-nats' (one time it has been published) and ensure all is good; then merge those changes into master (via Pull Request) ... maybe later (see next comment)
* [x] example: in the branch 'add-fastify-nats' branch, use the 'fastify-nats' pligin to send/receive messages with a publiuc NATS server; but instead (at least for now) use my fork of that plugin, 'fastify-nats-client' that has some more features and more updates ... ok, but do not merge this branch because in some cases the external NATS server could not be reachable (for example by corporate firewall rules), instead keep it not merged and see later if/what to do
* [x] general: add badges at the top of README ... ok
* [x] general: update 'fastify-cloudevents' to latest release ('0.2.0' or later), and update server script (some TODO in sources are for this) ... ok
* [x] general: update dependencies etc ... ok
* [x] general: add 'dotenv' in dependencies, to be able to define some environment-dependent variables in a '.env' file (excluded by source control) and have all them populated as environment variables ... ok, but use later if/when needed
* [x] example: in the branch 'add-fastify-nats' branch, use the 'fastify-nats' pligin to send/receive messages with a publiuc NATS server; but instead (at least for now) use my fork of that plugin, 'fastify-nats-client' that has some more features and more updates ... ok, but do not merge this branch because in some cases the external NATS server could not be reachable (for example by corporate firewall rules), instead keep it not merged and see later if/what to do
* [x] general: rebase the branch 'add-fastify-nats' on top of updated master ... ok, but instead of rebase I used a Pull Request (PR) and GitHub Review and Web UI to fix conflicts
* [x] general: to handle command-line options, use [yargs-parser](https://www.npmjs.com/package/yargs-parser) (already used in other Fastify-related projects) ... maybe later
* [x] general: to improve the NATS queue feature (usage), add a command-line flag to disable the publish/subscribe of messages to the public NATS server (and add an npm custom command with that flag) ... no, use an environment variable instead (see related note)
* [x] general: to improve the NATS queue feature (usage), configure the NATS server URL with the environmental variable NATS_SERVER_URL (for example using .env file), and use NATS_SERVER_DISABLE to disable it (and related features), instead of using command-line arguments/flags ... ok
* [x] general: in the '.env' (local, not in source control, as per best practices), comment the line with `NATS_SERVER_DISABLE=true`, and ensure all works as before ... ok
* [x] general: fix TODO in the `route` source, to be able to use publish/subscribe functions ... ok
* [x] general: to improve the NATS queue feature (usage), add even a counter for messages sent and received ... maybe later (not really needed now)
* [x] general: tag sources as '0.11.0' ... ok
* [x] general: tag sources as '0.11.1' with latest changes (see CHANGELOG and README)... ok
* [x] general: like in Fastify, add a custom npm command to perform a license check (but for production dependencies only) using 'license-checker', with only some acceptable licenses ('Apache-2.0;BSD-2-Clause;BSD-3-Clause;MIT;ISC'); some more info on Apache compatible/incompatible licenses [here](https://www.apache.org/legal/resolved.html#what-can-we-not-include-in-an-asf-project-category-x) ... done, but check what to do for a package that has a license (incompatible) 'Artistic-2.0'; note that even some npm related packages use that license, so a good compromise (for now) is to add it in acceptable licenses (even in the Apache compatibility page is not explicitly forbidden so should be good the same) ... note that this npm custom command still raise errors because other dependencies are found, fix later by removing my dependencies (using them) ... maybe later
* [x] general: on license-checker, for private npm packages still is seems that an 'UNLICENSED' license is assigned (without reading related license) ... ok, could be a bug in the library
* [x] general: get webhook secretKey from an environment variable (so could be defined like others enev in the '.env' file) or null, then test all cases (not present, present but wrong, present and good) ... ok
* [x] general: add a dev dependency on [ESDoc](https://www.npmjs.com/package/esdoc) and related plugins for esnext, etc, and the add an npm custom command to generate doc (in the usual output folder 'out' already excluded by '.gitignore'); and provide a configuration file for it (.esdoc.json') as seen in their docs ... ok
* [x] general: use ESDoc to generate the right documentation, at least for public functions (from folders './src/', and maybe even for './example/', './test/'), and add an npm custom task to generate/update it, but in this case in the './out/' folder (already excluded from commits, via '.gitignore') instead of the usual './docs/' ... ok, all done in the '.esdoc.json' configuration file
* [x] general: tag sources as '0.12.0' ... ok
* [x] general: simplify and generalize paths, and improve templates (and use common variables to merge with specific variables when using templates); move folders names into constants (maybe in a Map); then ensure all works as before ... ok
* [x] general: enable functions using feature flags (set in the environment) ... for NATS queue keep the (already existing) NATS_SERVER_DISABLE env var; for others check if/when to use a disable flag or an enable one ... ok, but used a disable logic, so by default any feature is enabled
* [x] general: move in a new source ('features.js') all code blocks that load?register/configure/etc application features; note that related source must accept arguments, so it has to be exposed as a function (or as a class) ... ok, implemented/exposed as a function (at least for now)
* [x] general: remove dependency on 'dotenv' and use its wrapper 'fastify-env' instead ... no, I tried but the plugin works in a way different that my setup here: all variables to read must be declared in the schema (which is good), are populated in async, etc; so I prefer ro revert to normal 'dotenv' usage
* [x] general: move listen port in the constants source (like others) ... ok, and removed from fastifyOptions because it was there only to be used manually
* [x] general: handle Fastify main options (for example the logger level, etc) via an environment variable (like for many other options); check if even the whole js object would be accepted in an env var (and by default use current value I used); then update README ... ok, and of course I had to write it as a JSON string, so: '{ "logger": { "level": "info" } }'; chose to used this as a default instead of an empty object ('{ }')
* [x] general: change all callbacks to follow best practices, so: ensure that a callbacks is callable (if it's a function), always pass error parameter first with something like 'function callback (err, data) { }', inside a callback always check for its error parameter (if not null), etc ... so here fix callbacks for cloudevents and callbacks for nats (check if related plugins must be updated before) ... note that for nats callbacks (cb) it seems no possible due to the underlying implementation ... maybe later, after 'fastify-cloudevents' release '0.3.0' or later (if callbacks will be changed with that format)
* [x] general: send some CloudEvent events (serialized) the the NATS queue ... done, now test all with nats feature enabled (then re-disable it) ... ok
* [x] general: as usual, update all dependencies to latest release ... ok
* [x] general: tag sources as '0.13.0' ... ok
* [x] general: check if use [require-all](https://www.npmjs.com/package/require-all) to load many/all source ('.js' and maybe even all '.json') files from a given folder, but filtered ... maybe later
* [x] general: check if use [fastify-acl-auth](https://www.npmjs.com/package/fastify-acl-auth) for a generic authentication and authorization flow for routes here ... maybe later
* [x] content: check if use [fastify-nextjs](https://www.npmjs.com/package/fastify-nextjs) to have a pre-configured (and simplified, ready to use) environment with React pages rendered at Server-Side, using [next](https://www.npmjs.com/package/next); but note that next has many dependencies; check if it could render pages even at client side; note that next can render even to static pages (to have a fully static web site); anyway try in a branch ... maybe later
* [x] content: check if add in 'package.json' a proxy statement like `"proxy": "http://localhost:8000/"`, as seen in [Proxying API Requests in Development - Create React App](https://facebook.github.io/create-react-app/docs/proxying-api-requests-in-development), [How to get create-react-app to work with a Node.js back-end API - freeCodeCamp](https://medium.freecodecamp.org/how-to-make-create-react-app-work-with-a-node-backend-api-7c5c48acb1b0), [Setting up a proxy server in create-react-app - vschool](https://coursework.vschool.io/setting-up-a-full-stack-react-application/), etc ... maybe later, because at the moment here I don't use React for the client part so I don't have a subproject in a folder '/client/' (and related 'package.json' where to put that setting); check if it would be useful the same with a different framework for client side, like Angular
* [x] general: add npm custom command to run unit tests with nodejs debugger breaks enabled (inspector) and no parallel and no timeout, useful for example in Visual Studio Code; some info [here](https://github.com/fastify/fastify/blob/master/docs/Testing.md), [here](https://nodejs.org/en/docs/guides/debugging-getting-started/), [here](https://code.visualstudio.com/blogs/2018/07/12/introducing-logpoints-and-auto-attach) ... ok, added a debugger attach configuration (in '.vscode/launch.json'), and an npm custom command 'test:unit:debug' to run Tap unit tests with Node.js inspector enabled (and without timeout)
* [x] general: implement some automation tool, using [Gulp](https://gulpjs.com/) or [WebPack](https://webpack.js.org/) ... maybe later, but with [WebPack](https://webpack.js.org)
* [x] general: rewrite all using latest [TypeScript](https://www.typescriptlang.org/), but in a branch (and merge later into master) ... maybe later, or (even better) in a similar project 'fastify-example-ts'
* [x] general: update folders for pages (public, templates, etc) to move all under a 'web' or 'pages' folder (but with 'git mv' to not losing files history) ... maybe later
* [x] general: check if introduct the [TypeScript]() compile, maybe only to let it check JavaScript code, as seen [here](https://slack.engineering/typescript-at-slack-a81307fa288d) and [here](https://blog.bitsrc.io/why-and-how-use-typescript-in-your-react-app-60e8987be8de) ... maybe later, but do changes in a branch
* [x] general: in 'features.js' source, check if add an internal function that uses `const NODE_ENV = process.env` to give only env var name (as a string), to hide that's reading from the env ... ok, but added in utilities functions, in 'utils.js'
* [x] general: refactor main server source as described in [Testing - fastify](https://github.com/fastify/fastify/blob/master/docs/Testing.md), for simpler testing and have Fastify instance exposed by a specific source (maybe a new here here) ... maybe later
* [x] general: as a sample, under the folder './docs/', add a copy of Visul Studio Code launch configurations (copied from project root '.vscode/launch.json') because usually the folder '.vscode/' is excluded by git (by adding it in '.gitignore') ... ok
* [x] general: as a sample, under the folder './docs/', add a copy of a sample local environment variables configurations (copied from project root '.env' but renamed into '_env') because usually that file (and related variants) is excluded by git (by adding it in '.gitignore') ... ok
* [x] general: enable strict mode in all created CloudEvent instances if environment is not production ... better, use a feature flag like others (so something like 'FEATURE_CLOUDEVENTS_STRICT_DISABLE') and get it from env vars (so disable/enable it in any specific environment); then update related info in the README ... ok
* [x] general: check how to pass to the Docker container all environment variables used here (called 'feature flags', and maybe even others); see [Builder - Docker Docs](https://docs.docker.com/engine/reference/builder/#arg); and the same for env vars; note that ARG variables (set via the '--build-arg' flag to 'docker build' command) are not persisted into the built image, but ENV variables (set via the '--env' flag in 'docker run/exec' commands) yes; and ENV variables have priority over ARG variables, so a good trick is to set ARG and then ENV to refer to it but with a default value; maybe then check if use even for specify a user for running the node process in the container, andthe production mode (or not) for npm install, etc ... ok, but maybe later
* [x] general: improve Docker image generated here using some tricks seen [here](https://blog.bitsrc.io/manage-your-node-app-using-docker-like-a-pro-6266f6516cf), like multi-stage image, etc ... maybe later, not really needed here at the moment (no package generation via WebPack or other similar)
* [x] general: improve the flow and data transformation paths using CQRS and Event Sourcing (ES), for example as seen [here](https://blog.bitsrc.io/building-a-cqrs-es-app-with-resolve-41f839362ffd) ... maybe later, not really needed here now
* [x] general: check if the warning "Promise may not be fulfilled with 'undefined' when statusCode is not 204" (since Fastify 1.13.4) is related to the 'ejs' templating engine ... ok, it was related to exposing routes as an async function, and even the '/template' route was defined with an async function but without return value, so for now I fixed all by moving back to normal (non-async) functions; let's improve later
* [x] general: update all dependencies, mainly to latest 'fastify-cloudevents' release '0.3.0' or later ... ok, all works good as before
* [x] general: change all callbacks to the (standard) arguments format like 'function callback (err, data) { }', could call the callback with (err, null) or with (null, data) ... no, it doesn't worth the effort because at the moment I'm not using so much async functions here, and normal callbacks are good enough at the moment
* [x] general: update info in the README and CHANGELOG ... ok
* [x] general: tag sources as '0.14.0' ... ok
* [x] content: check if/how to use [lit-html](https://lit-html.polymer-project.org/guide) and [lit-element](https://lit-element.polymer-project.org/guide) as templating/view engine; but note that at the moment there is not plugin (nor support in 'point-of-view') ... no, it's too early now and related Server-Side Rendering (SSR) is provided only by a third party library (otherwise those modules works only at client side); but maybe later
* [x] general: update all dependencies and all my plugins to latest, for example 'fastify-cloudevents' ... ok
* [x] content: remove some inline definition/behavior and use instead those exposed by the new release of 'fastify-cloudevents' ... ok
* [x] general: bump release ... no, because here I keep the same release (at least for now on '1.0.0') and I tag sources at the end of any minimal and continuous release
* [x] general: Docker image, in the 'Dockerfile', add some LABEL statements to add more info on Node.js version, Fastify version, etc; if possible the same statement but multi-line ... maybe later
* [x] general: Docker image, in the 'Dockerfile', add an argument (ARG), and its override from environment (ENV) for specifying if install production only dependencies or not (all dependencies, even for dev) ... ok, but keep 'development' as default
* [x] general: Docker image, in the 'Dockerfile', group all ENV statements in a single one but multi-line (one key/value per line), should be possible ... maybe later
* [x] general: Docker image, in the 'Dockerfile', do some small tweaks and improvements, using official [Node.js Docker image](https://hub.docker.com/_/node/) by default based on Debian ... ok; created even a group and user to run the webapp (in a safer way, instead of the default root in Docker containers) and related file system permissions in its folders, as seen [here](https://www.digitalocean.com/community/tutorials/how-to-build-a-node-js-application-with-docker) for example
* [x] general: Docker image, check using the alpine version, so 'node:8-alpine' (much smaller, based on BusyBox, instead of the normal node image), if it's good enough for all commands used here; and maybe add another Dockerfile for the other base image (not based on alpine, so the current one), like 'Dockerfile.dev'; but check if it would be possible to run for example the npm custom task 'healthcheck-manual', otherwise keep the alpine version as a secondary Docker image ... start by creating a dedicated 'Dockerfile.alpine' for production but not referenced in npm custom commands (maybe in a command like 'docker:build:alpine') ... ok, but used the tirck to tag the image with the same name, to be able to resuse others npm custom command already defined (most)
* [x] content: expose a route that always raise an error ... ok
* [x] general: use new features exposed by 'cloudevent' (wrapped by 'fastify-cloudevents') to build CloudEvent instances from Error, etc ... maybe later, because I need related hook (since Fastify v2)
* [x] general: update changelog ... ok

* [x] general: tag sources as '0.15.0' ... ok
* [x] general: update all my other plugins to '1.0.0' (for Fastify v1) when available: 'fastify-nats-client', 'fastify-webhook', and maybe others ... ok
* [x] general: use new features of my plugins (new releases) ... ok
* [x] general: update changelog ... ok
* [x] general: tag sources as '0.16.0' and then maybe even as '1.0.0' ... ok
* [x] general: after the '1.0.0' release, create a maintenance branch '1.x' ... ok

* [x] general: bump release to '2.0.0' ... but only when my plugin 'fastify-cloudevents' will be compatible to Fastify v2 ... ok, all updated now (mine and all others)
* [x] general: unsure all works with latest Node.js 8.x ... then ensure that publishing to NATS queues works good (on-line and even in the Docker version) ... ok
* [x] general: update to Fastify v2, but in a branch (at the beginning, until it works); then merge with a PR (but merge with squash) ... ok
* [x] general: update my code to use new/updated features of my plugins, and fix all breaking changes ... ok
* [x] general: use new features exposed by 'cloudevent' (wrapped by 'fastify-cloudevents') to build CloudEvent instances from Error, etc ... ok
* [x] general: check if use [fastify-sensible - Fastify](https://github.com/fastify/fastify-sensible), to add some standard and useful defaults ... maybe later
* [x] general: add here the same additional lint command (via TypeScript and related plugins, and maybe even with TSLint) ... no, not really needed here because all code is JavaScript, but maybe later
* [x] general: update readme ... ok
* [x] general: update changelog ... ok
* [x] general: tag sources ... ok
* [x] general: after the '2.0.0' release, create a maintenance branch '2.0.x' ... ok

* [x] content: implement a full-stack webapp, with a modern front-end (Angular or React or Vue.js or other); use even some modern css framework like Bootstrap (but without jQuery etc); for example see [React Bootstrap Tutorial - LogRocket](https://blog.logrocket.com/how-to-use-bootstrap-with-react-a354715d1121) and then use [reactstrap - npmjs](https://www.npmjs.com/package/reactstrap) or [react-bootstrap - npmjs](https://www.npmjs.com/package/react-bootstrap) and WebPack to bundle all ... maybe later because this need a change in the structure of all the repo (to become a monorepo), to be managed in a different way, as seen in [Why one big repo - Rush](https://rushjs.io/pages/intro/why_mono/); see even [here](https://itnext.io/essentials-of-monorepo-development-53992471fa8), at [Monorepo design - Babel](https://github.com/babel/babel/blob/master/doc/design/monorepo.md), etc; of course monorepo makes sense for all related subprojects (like subprojects of the same product)

* [x] general: update requirements to Node.js 10.x, at least in Docker files ... ok
* [x] general: update utils functions ... ok
* [x] general: bump release to '2.1.0' ... ok
* [x] general: update dependencies ... ok
* [x] general: add a feature flag to disable Fastify logging ... ok, with the env var FASTIFY_OPTIONS, otherwise by default Fastify logger will be enabled from the 'info' level
* [x] general: remove dependencies (and dev dependencies) not really used here ... ok
* [x] general: for a more Functional Programming (FP) approach, use [ramda - npm](https://www.npmjs.com/package/ramda) instead of usual [LoDash - npm](https://www.npmjs.com/package/lodash) or [Underscore - npm](https://www.npmjs.com/package/underscore) ... ok, but maybe later
* [x] general: add a feature flag to change the callback for CloudEvents, to send to a webhook (of course via HTTP POST) ... maybe later
* [x] general: check if restructure the whole project to become a monorepo (with multiple interdependent packages inside it, for example using [lerna - npmjs](https://www.npmjs.com/package/lerna) or [rush - npmjs](https://www.npmjs.com/package/@microsoft/rush), like: server, common, client, docs, etc ... maybe later
* [x] general: use the new release of 'fastify-cloudevents' aligned with v0.2 of the spec (when the plugin will be available); and update all accordingly (even add packageName and packageVersion to event 'type' base value, and major release to 'schemaurl' where used like '/v1/') ... ok
* [x] content: cleanup/update to latest standards my custom styles, using [autoprefixer - npmjs](https://www.npmjs.com/package/autoprefixer) and [postcss - npmjs](https://www.npmjs.com/package/postcss), and keep only last 2 versions of most common browsers ... use the online version for example at [autoprefixer - github](https://autoprefixer.github.io/) ... ok, but now to target only 1 last version of most common browsers
* [x] content: update home page with a link to a samples page (with a statically defined sorted list to all published routes, with related description) ... ok
* [x] content: check if publish lifecycle events in a different queue, and error events in another; for example use current queue name (composed of packageName and packageVersion) as base, and add '.lifecycle', '.error', and '.app' for specific messages generated inside routes, etc; then (as a sample) subscribe to all those queues, but print queue name or at least its short name (if possible) just before the message received from it ... maybe later
* [x] general: to simplify automatic changes for releases, follow the guidelines at [
Easy Automatic npm Publishes - The npm Blog](https://blog.npmjs.org/post/184553141742/easy-automatic-npm-publishes), so follow [Conventional Commits](https://www.conventionalcommits.org/) and check if use [standard-version - npmjs](https://www.npmjs.com/package/standard-version) for automatic changelog redaction ... maybe later
* [x] general: update dependencies ... ok
* [x] general: update changelog ... ok
* [x] general: tag sources, at least going to '2.1.0' ... ok

* [x] content: restructure/align my css with the [abvcss](https://abvcss.github.io/abvcss-website/) methodolgy ... maybe later
* [x] content: improve Promise and async/await usage in my code, as seen for example in [Deeply Understanding JavaScript Async and Await with Examples - Bits and Pieces](https://blog.bitsrc.io/understanding-javascript-async-and-await-with-examples-a010b03926ea) ... yes, but maybe later

* [x] general: bump release to '2.2.0' ... ok
* [x] general: at server startup, get some environment info (like Node.js version with `process.version`, OS name/type, OS release, OS platform with the old `process.platform`, etc) and print to log; implement them in the 'utils' source (but not Node.js specific code with 'require' there), and maybe later implement even similar features but for a Browser environment; some info in [os - Node.js](https://nodejs.org/api/os.html), and [here](https://coderwall.com/p/qgsnbq/check-node-js-version-in-code), [here](https://www.w3schools.com/js/js_window_navigator.asp), [here](https://stackoverflow.com/questions/8683895/how-do-i-determine-the-current-operating-system-with-node-js), etc ... for now, add some function related to `process` Node.js data structure (as some is already present, similar), but not others that require Node.js specific import; and implement Browser specific features maybe later ... enable this with a feature flag, using the env var 'FEATURE_PLATFORM_INFO_DISABLE'; note that process id (pid) and hostname are already written in Fastify logs by default ... ok, done
* [x] general: check if remove some Fastify plugins not really used at the moment, but keep 'fastify-static' (even if for a real deployment probably static assets will be delivered via NGINX or another Web Server) ... remove 'fastify-compress', 'fastify-cookie', 'fastify-session'; then ensure all works as before ... ok, maybe re-add later if/when really needed/used
* [x] general: update Tap (Node-Tap) to latest (from '^12.7.0' to '^13.0.3' or later) ... note that new Tap now complaints on a not existing nested path for test sources, so maybe I'll need to update npm custom command to remove 'test/*/*.test.js'; and (currently) it seems to complaint on the `'use strict'` statement and on eslint comments, on top of test sources, and even on anything not inside tests; check better what happens ... ok using latest tap (currently '^13.1.6'), but I had to remove the '--strict' flag in npm custom commands 'test:unit' and 'test:unit:debug'; note that still there are some eslint comments in some sources that test coverage (npm custom command 'test:coverage') doesn't like (for example the 'utils' source), check with Node-Tap guys (I get the error: `Cannot read property 'f' of undefined`); note that the first time i run tests all works, but after it all next test run fails with the same error, and I need to cleanup the 'node_modules' folder and re-install dependencies, weird; Tap guys told me to add the '--no-esm' flag and this resolve (probably they need to fix something the same, even when running with Node.js 8.16.0); updating to latest Tap ('13.1.8') there is even the bug fix for the '--strict' argument, so I can re-add it in my nom custom commands
* [x] general: remove dependency on ESDoc and related plugins ('esdoc', 'esdoc-standard-plugin', 'esdoc-ecmascript-proposal-plugin', 'esdoc-node'), not really used here; but keep its configuration file ('.esdoc.json') because it could be useful; last, remove related npm custom command ('docs' which does 'npx esdoc') ... ok
* [x] general: update to latest Fastify (currently '^2.3.0') in requirements, even if not strictly needed ... ok
* [x] general: update all requirements to Node.js 10.x (more modern, even if not strictly required here, but just to start using it); in Docker images it has already been done ... note that if run with a previous version (like Node.js 8.16.0) no error is thrown; check if there is a standard way to do this, and if there isn't enable with a feature flag ... as seen [here](https://stackoverflow.com/questions/29349684/how-can-i-specify-the-required-node-js-version-in-package-json), and even in [npm-config - npmjs](https://docs.npmjs.com/misc/config) it seems that a good way could be to run a command like `npm config set engine-strict true` from project root; otherwise I could implement by code (probably using 'semver' for a better range check, and maybe provide a configuration flag to raise a warning or raise an error, or do nothing), or use a module like [check-node-version - npmjs](https://www.npmjs.com/package/check-node-version) ... ok, and improve/implement something for this but maybe later (here or better in a dedicated Fastify plugin)
* [x] content: to improve navigation of samples routes, rename 'samples' in 'sampleRoutes' (with all routes published by my code), and add another section with 'pluginRoutes' with a (manual defined) sorted list of routes published by plugins loaded; and mark related area/div with a border ... ok, then maybe move all them in a navigation section/div
* [x] content: update header and footer with better colors, and better info, like: in header a link to Home, in footer info on framework release, webapp release, etc ... ok, done some small change even in 'style.css'
* [x] content: check why the new 'fragment-navigation' does not show in the right way navigation links (and then maybe remove from header and add there a logo) ... ok, fixed by moving the navigation fragment nested in the header (and using an include)
* [x] content: in the fragment header, add a div for main logo, like: `<div id="logo"><a href="#" alt="Logo"><img src="<%= assets %>img/logo.png'"/></a></div>` ... maybe later
* [x] general: analyse how to implement a serialization of CloudEvents into a log file ... write all into a single log file, and then (if/when needed) use an OS utility like 'logrotate' to move old log data in archive files, for example as seen [here](https://www.linode.com/docs/uptime/logs/use-logrotate-to-manage-log-files/), but when logging into JSON format, take in account even [8 Handy Tips to Consider When Logging in JSON - loggly](https://www.loggly.com/blog/8-handy-tips-consider-logging-json/), [Java Logging Guide - DataDog](https://www.datadoghq.com/blog/java-logging-guide/), etc; other useful info that could help (in general, probably not in this specific case) even [here](https://www.loggly.com/blog/what-60000-customer-searches-taught-us-about-logging-in-json/), [here](https://www.graylog.org/post/log-file-parsing), [here](https://www.baeldung.com/java-log-json-output), [here](https://stackoverflow.com/questions/52343121/how-can-i-parse-this-json-log-output-into-a-list-of-my-bean), [here](https://github.com/tersesystems/terse-logback), etc ... note that an important point is to write any log item (in JSON format, ok) alone, so when log file split should occur (or server stops or other), log file will be parseable the same, even if stricly it won't be a whole (monster ?) JSON object in its own ... ok, so let's use a (JSON) Structured Logging, and since there are several JSON objects all in one file/stream, this is called "newline delimited JSON", sometimes referred as [NDJSON](http://ndjson.org/) or [JSONLines](http://jsonlines.org/)
* [x] general: update all usual ignore files ('.gitignore', '.npmignore', '.dockerignore', etc) to add (exclude) the 'logs' folder and all its content that matches the pattern '*.log*' ... ok
* [x] general: check if/how Fastify handle terminating signals like SIGTERM, that for example could be sent when running inside Kubernetes (k8s) ... ok, it seems Fastify already handles SIGTERM or SIGINT; otherwise there is the plugin [fastify-graceful-shutdown - npmjs](https://www.npmjs.com/package/fastify-graceful-shutdown), and a discussion (maybe outdated now) [here](https://github.com/fastify/fastify/issues/260), and check with updated hook 'onClose' in [Hooks - Fastify](https://github.com/fastify/fastify/blob/master/docs/Hooks.md)
* [x] content: analyse to provide a route to serve SPA (all client-side UI); but check if this is possible without specific build phase for it ... ok, analysis done; look at [fastify-example-twitter - fastify](https://github.com/fastify/fastify-example-twitter) as a (complete) sample, where any part (frontend, common, and other parts) is in its own subfolder (with related 'package.json') and main project build/executes all them in the right way; for another interesting sample but made in TypeScript, look at [fastify-auto-push - google](https://github.com/google/node-fastify-auto-push)
* [x] content: update css by adding some colors (to move later in a theme, and use with it as override) ... ok
* [x] general: for writing rows into the log file in an efficient way, use Node.js Streams; see [Stream - Node.js API](https://nodejs.org/api/stream.html), and even [Node.js Streams - freeCodeCamp](https://medium.freecodecamp.org/node-js-streams-everything-you-need-to-know-c9141306be93), etc ... ok
* [x] general: add some useful functions using ES6 Proxy, similar to those seen in [A practical guide to Javascript Proxy - Bits and Pieces](https://blog.bitsrc.io/a-practical-guide-to-es6-proxy-229079c3c2f0) ... maybe later
* [x] general: add a feature flag to change the callback for CloudEvents, to save them in a structured log file ('.json.log', or '.jsonl') in the 'logs' folder (already added to all ignore files) ... for a performance point of view, try to write to the file as a stream (in async way if possible), and handle the file open/close by attaching to Fastify events; if log file is found at start, rename it with its timestamp at the end (so nothing will be deleted, and any run has its own log file) ... for simplicity reuse the same callback, but with two new feature flags: FEATURE_CLOUDEVENTS_LOG_CONSOLE_DISABLE, FEATURE_CLOUDEVENTS_LOG_FILE_DISABLE ... ok
* [x] general: improvement of CloudEvents log file: when the webapp starts, if a log file already exist, it will be renamed (appending the timmestamp if its last write, or the current one) so nothing is lost ... maybe later, bacause this could lead to fill disks (without un upper limit), so maybe could be implemented later with a new feature flag
* [x] general: improvement of CloudEvents log file: check why the hook 'onClose' is not triggered ... ok, is not triggered because that hook is triggered when `fastify.close()` is invoked to stop the server, see [Hooks - Fastify](https://github.com/fastify/fastify/blob/master/docs/Hooks.md), mainly per providing a 'shutdown' event to plugins; otherwise I should use the plugin [fastify-graceful-shutdown - npmjs](https://www.npmjs.com/package/fastify-graceful-shutdown) but maybe later
* [x] general: update changelog for the upcoming release ... draft written, check then update release date ... ok, updated to today
* [x] general: tag sources, at least going to '2.2.0' ... ok

* [x] general: in 'utils', check if implement features similar to those seen in the [article](https://medium.com/front-end-weekly/error-handling-in-node-javascript-suck-unless-you-know-this-2018-aa0a14cfdd9d) ... maybe later
* [x] general: implement something like [this](https://www.freecodecamp.org/news/javascript-inheritance-vs-composition-ec8ca848b6/) ... maybe later
* [x] general: for acting here even as an api server that replies even to long elaborations, check if/how to implement delayed replies: via status uri and token, via streaming, web socket, etc ... maybe later
* [x] general: at the beginning of executable scripts (like my examples or main scripts), check if add an hashbang statement: `#!/usr/bin/env node` but it must be put in the (absolute) first line of a script, so check if there are problems with license (usually put at the beginning of a source file) ... maybe later, to avoid unneeded problems (even when running those scripts in Windows where all should work the same); anyway note that now these statements are standard, see [here](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Lexical_grammar#Hashbang_comments), at this [article](https://medium.com/netscape/a-guide-to-create-a-nodejs-command-line-package-c2166ad0452e), etc
* [x] general: to publish Docker images to be run in production, use multistage images: use first stage as builder (to build content), and the second for example to publish all static content of the webapp via an HTTP Server, and/or a reverse proxy for the whole webapp; for more info look at this [article](https://itnext.io/building-docker-images-from-private-git-repositories-using-ssh-login-433edf5a18f2
) ... maybe later, because this is mainly suited for client-only apps (with only static content is deployed), so could be a good improvement, but later
* [x] general: publish current image to DockerHub, and tag there accordingly ... ok, created repository and published normal image (with tag '2.2.0' and even with default tag 'latest') and even the variant (tag '2.2.0-alpine' and 'latest-alpine'); all is at [fastify-example - smartiniatdocker09 - docker](https://cloud.docker.com/repository/docker/smartiniatdocker09/fastify-example/general); a dedicated file 'docs/Docker-publish.md' will follow with detailed info

* [x] general: bump release to '2.3.0' ... ok
* [x] general: update all dependencies to latest ... ok
* [x] general: update requirements to latest Fastify release ('^2.4.1' or later), as seen in [Fastify - Releases - GitHub](https://github.com/fastify/fastify/releases), even in README ... ok
* [x] general: add my new plugin for checking some environmental properties at runtime, see [fastify-check-runtime-env - npmjs](https://www.npmjs.com/package/fastify-check-runtime-env) ... ok
* [x] general: add a badge even for license, like: `[![license - APACHE-2.0](https://img.shields.io/npm/l/fastify-example.svg)](http://opensource.org/licenses/APACHE-2.0)` ... not here because there is no package published at npm for this repo, but for others do it
* [x] general: at DockerHub, update autobuild rules to trigger even the push of git tags, to build (and tag) related images; one for usual 'Dockerfile', and another for 'Dockerfile.alpine' with suffix '-alpine' ... ok
* [x] general: remove badges (at the top of README) for latest release at npm and number of downloads (because this is not published there, it's not a library/framework), and even the code coverage ... ok
* [x] general: add badges (at the top of README) for the number of pulls of Docker images ... ok, but add only one badge for it at the moment (not sure it's possible to add many related to different 'latest' tags I set)
* [x] general: add badges (at the top of README) for Docker images (latest releases) if possible ... maybe later
* [x] general: check if use [node-fetch - npmjs](https://www.npmjs.com/package/node-fetch) to get content via HTTP/HTTPS, in a similar way to Browsers; for example look at this [article](https://humanwhocodes.com/snippets/2019/01/nodejs-medium-api-fetch/) ... maybe later
* [x] general: check if add all feature flags to both Dockerfiles, as ENV statements ... maybe later, they are overridable the same from the command-line, so this would be more a documentation improvement
* [x] general: create 'docs/Docker-publish.md' with detailed info on how to publish images to DockerHub ... ok
* [x] general: update README clarifying usage of Docker images published at DockerHub at [smartiniatdocker09/fastify-example - DockerHub](https://hub.docker.com/r/smartiniatdocker09/fastify-example); and explain that there are two: the normal (even with DEV dependencies, bash shell, etc), and another minimal based on Alpine (and with setting for Production environment only) ... ok
* [x] general: remove dependency from 'semver', not really used directly, and now used by my plugin 'fastify-check-runtime-env' (so safe to remove) ... ok
* [x] general: configure my plugin 'fastify-check-runtime-env' to throw error if current Node.js version is not compatible with the one set in 'package.json'; handle with a feature flag if log a warning, or if throw an error (by default) ... ok, but for simplicity use only a single feature flag now 'FEATURE_CHECK_RUNTIME_ENV_DISABLE' to throw an exception if needed; and update README with some info on it
* [x] general: update changelog for the upcoming release ... ok
* [x] general: in changelog add even references to images published at DockerHub, with related tags: 'latest' and '2.3.0' for the normal image, and 'latest-alpine' and '2.3.0-alpine' for the other based on Alpine Linux ... add a similar reference even in changelog for (previous) release '2.2.0' ... ok
* [x] general: tag sources, at least going to '2.3.0' ... ok
* [x] general: publish current image to DockerHub, and tag there accordingly ... note that with automatic builds defined (on push and on tags, this maybe is no more needed) ... ok

* [x] general: bump release to '2.4.0' ... ok
* [x] general: update dev dependencies to latest ... ok, updated even standard from 13.x ('13.1.0' to 14.x ('14.0.0')
* [x] general: use Node.js assertions but in strict mode now, as seen in [Assert - API - latest - Node.js](https://nodejs.org/dist/latest/docs/api/assert.html#assert_strict_mode); do it with `const assert = require('assert').strict` instead of the usual `const assert = require('assert')` ... doc say added in Node.js 8.9.0, and with 8.16.1 (and later) is available; but it's not available in Node.js 8 LTS (8.9.0) ... ok, because here I'm already requiring Node.js 10 LTS as minimum version, so it's good to apply this change now
* [x] general: check if use a trick like exporting all required modules in a specific source even here, as seen [here](https://school.geekwall.in/p/SkXDyiODV/managing-npm-functions-in-node) ... maybe later
* [x] general: updated all dependencies (minor release for ejs etc, and even major releases for some dependency), so ensure all works as before ... ejs fragments/templates seems to not work anymore, fix it asap; then test/fix others before committing changes ... it seems in the new release of [mde_ejs](https://github.com/mde/ejs) somethings has changed (but in a better way), so `includes either have to be an absolute path, or, if not, are assumed as relative to the template with the include call`, and it seems there isn't a general settings for it ... ok, fixed now, and even 'server-simple.js' script
* [x] general: ejs templates/fragments, in the include directive, don't use anymore the (old) preprocessor syntax (`include fragment-head`), but use the newer runtime inclusion (`include('fragment-head')` or `include('fragment-head', local_variables_for_fragment)`) instead; for more info look at [Syntax - ejs](https://github.com/mde/ejs/blob/master/docs/syntax.md) ... no, at least not for now it seems doesn't really work well here, check later
* [x] general: add badge for vulnerabilities via [snyk](https://snyk.io), as for https://github.com/mde/ejs which references https://snyk.io/test/npm/ejs ...  so something like this should be added: `[![Known Vulnerabilities](https://snyk.io//test/github/smartiniOnGitHub/fastify-example/badge.svg?targetFile=package.json)](https://snyk.io//test/github/smartiniOnGitHub/fastify-example?targetFile=package.json)` ... ok
* [x] general: update requirements to latest Fastify release ('^2.10.0' or later), as seen in [Fastify - Releases - GitHub](https://github.com/fastify/fastify/releases), even in README ... ok, updated to latest; even to latest plugin 'point-of-view' with some fixes in docs for ejs templates
* [x] general: update Dockerfile of both images, so that installed packages will be updated, to reduce risk of vulnerabilities ... ok
* [x] general: use the new release of 'fastify-cloudevents' aligned with v0.3 of the spec (when the plugin will be available); and update all accordingly ... ok, updated to '^2.3.0' (just released)
* [x] general: update all dependencies to latest ... ok
* [x] general: check if use here even plugin [fastify-cors - npmjs](https://www.npmjs.com/package/fastify-cors), even if not strictly required now ... maybe later
* [x] content: use [ramda - npmjs](https://www.npmjs.com/package/ramda) to do some processing operations on data ... maybe later
* [x] content: check if use [Stencil - npmjs](https://www.npmjs.com/package/@stencil/core) for Web Components as client side UI, at least in a new SPA here ... no

* [x] general: bump release to '2.5.0' ... ok
* [x] content: as a sample, provide a route to serve SPA (all client-side UI) via [Preact - npmjs](https://www.npmjs.com/package/preact) (like React but without transpillation of code and without depending on Babel, so simpler), doing something like described in the article [Fastify and Preact for quick web app prototyping - Loige](https://loige.co/fastify-and-preact-for-quick-web-app-prototyping/); but as a Single-Page-Application (SPA) in a dedicated route; for the implementation follow the analysis already done here ... maybe later, but using a better approach, using the http proxy plugin so to proxy another (separate) client app
* [x] general: for Functional Testing, try to use [puppeteer - GitHub](https://github.com/puppeteer/puppeteer) as Headless Chrome Node.js API ... sure, but maybe later
* [x] content: check if add some semantic tags/attributes into pages/templates, as seen in [Getting Started - Schema.org](https://schema.org/docs/gs.html); see even [JSON for Linked Data - JSON-LD](https://json-ld.org/) ... maybe later
* [x] content: check if this online tool could be useful to perform a modern setup of my css sample layout: [CSS Grid](https://grid.layoutit.com/) ... sure, but maybe later
* [x] general: check if use here even plugin [fastify-jwt - npmjs](https://www.npmjs.com/package/fastify-jwt) ... ok, plugin added in dependencies, even if not strictly required now
* [x] general: check if use even this plugin for authentication: [fastify-esso - npmjs](https://www.npmjs.com/package/fastify-esso); similar to JWT but more complete; very interesting the approach to simplify multi microservices authentication with and without a Central Authentication Server (CAS) for example made with a dedicated microservice ... interesting, but maybe later (if/when it will have more support and rela world usage too)
* [x] general: otherwise, check if use the plugin [fastify-jwt-webapp - npmjs](https://www.npmjs.com/package/fastify-jwt-webapp) ... maybe later, first prefer official Fastify plugins
* [x] general: add plugin [fastify-formbody - npmjs](https://www.npmjs.com/package/fastify-formbody) to manage in a simple way form url-encoded data (MIME Type application/x-www-form-urlencoded, but not multipart/form-data); for more complex ways, look at plugins like [fastify-multipart - npmjs](https://www.npmjs.com/package/fastify-multipart) (but note that it was mainly for file uploads), or even [fastify-multer - npmjs](https://www.npmjs.com/package/fastify-multer), etc ... ok
* [x] general: update requirements to latest Fastify ^2.12.0 ... ok
* [x] content: simplify my sample css with some new features seen [here](https://web.dev/next-gen-css-2019/) ... maybe later
* [x] content: check if provide an SPA (maybe a new one) even as a Progressive Web-App (PWA), for example as seen [here](https://blog.heroku.com/how-to-make-progressive-web-app) ... maybe later
* [x] content: check if manage responsive images in a way similar to that described in this article [Responsive images, the simple way - CloudFour](https://cloudfour.com/thinks/responsive-images-the-simple-way/) ... maybe later
* [x] general: log a warning if current Node.js release is different (for example lower) than expected, currently min Node.js 10 LTS (10.13.0) is required ... ok
* [x] general: update requirements to latest Fastify ^2.13.0 ... ok
* [x] general: Docker images, look at this very interesting article: [Top 4 Tactics To Keep Node.js Rockin in Docker - Docker Blog](https://www.docker.com/blog/keep-nodejs-rockin-in-docker/) and related sample repository [BretFisher/node-docker-good-defaults - GitHub](https://github.com/BretFisher/node-docker-good-defaults) ... ok
* [x] general: check if use the [actor model](https://en.wikipedia.org/wiki/Actor_model) even in web applications (the logic, but maybe even in UI components, etc), all based on immutable message passing, transparency location, running on default or on other threads (vis workers here), etc; for example look at the following repos: [PolymerLabs/actor-boilerplate](https://github.com/PolymerLabs/actor-boilerplate), [PolymerLabs/actor-helpers](https://github.com/PolymerLabs/actor-helpers), [EdwardIrby/actor](https://github.com/EdwardIrby/actor), etc ... maybe later, it's very interesting but too early here, even tese repos are almost POC (Proof-Of-Concept) or abandoned; a very robust (maintained and used a lot) is [Akka - GitHub](https://github.com/akka/akka) but only for Java and Scala
* [x] general: find a way to manage any kind of PII (Personally Identifiable Information) about users here (in logs, etc), for example following some tricks seen [here](https://blog.logrocket.com/how-to-handle-pii-websites-web-apps/); some info at [Personal data - Wikipedia](https://en.wikipedia.org/wiki/Personal_data) ... no, it's not really useful here (no users data stored) and it's a very complex topic, with different laws (GDPR for Europe, another for USA, etc)
* [x] general: store in a secure way all JWT tokens, for example as seen in [How to securely store JWT Tokens - dev.to](https://dev.to/gkoniaris/how-to-securely-store-jwt-tokens-51cf) ... ok, but implement as a work-in-progress; maybe at least implement later a filter on user browser to reduce attack surface, as seen in [bowser - npmjs](https://www.npmjs.com/package/bowser), [detect-browser - npmjs](https://www.npmjs.com/package/detect-browser) and [express-useragent - npmjs](https://www.npmjs.com/package/express-useragent) and then check if extract into a Fastify plugin; in real world usage maybe let the web server/reverse proxy (NGINX or Apache HTTPD or other) do that task
* [x] general: support only Node.js active versions (if possible only LTS ones) as seen in the following [article](https://medium.com/the-node-js-collection/maintainers-should-consider-following-node-js-release-schedule-ab08ed4de71a) ... ok, it was already done here some time ago, and in general it's a good choice (even from a safety point of view and maintanibility of dependencies and runtime); Fastify guys just did the same with latest release; note that of course drop major (old) versions should be done in a major semver release
* [x] general: update requirements to latest Fastify '^2.14.0' ... ok
* [x] content: check if offload some computation to [Web Workers - MDN](https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API), as seen for example in 
[Simplify Web Worker code with Comlink - davidea.st](https://davidea.st/articles/comlink-simple-web-worker), that uses the library [Comlink - npmjs](https://www.npmjs.com/package/comlink) ... maybe later, even if really interesting, but more focused for a full front-end part (to have the single thread UI more responsive); anyway, check if could be useful even for the back-end part
* [x] content: remove my custom styles from pages and change with some good default style, for example starting from latest [Bootstrap](https://getbootstrap.com/), then update licenses ... no, Bootstrap continues to use jQuery, stop using that stuff; instead update my custom styles, or maybe use other (more modern) styles
* [x] content: check if improve even font rendering in pages, as seen [here](https://davidea.st/articles/tips-for-loading-web-fonts) ... maybe later, it's more a css enhancement
* [x] general: update code to use only ES Modules, to reduce size of dependencies, as seen in [How CommonJS is making your bundles - web.dev](https://web.dev/commonjs-larger-bundles/) ... maybe later, very interesting (and for sure to use in a client-only app) but not really relevant here; and in any case ES Modules are enabled by default only since Node.js release 13.2.0 and later, and much better from 14.0.x (so retry later); before (since release 8 LTS, but much better since 12 LTS), it would needed to enable the flag '--experimental-module'; for more info look at [ECMAScript Modules | Node.js Documentation](https://nodejs.org/api/esm.html), [Node.js support for ES Modules - Medium](https://medium.com/@nodejs/announcing-core-node-js-support-for-ecmascript-modules-c5d6dc29b663), [ECMAScript Modules | Node.js 12.x LTS Documentation](https://nodejs.org/docs/latest-v12.x/api/esm.html), [ES modules in Node today - LogRocket Blog](https://blog.logrocket.com/es-modules-in-node-today/), etc
* [x] general: check if implement some mechanism for manage concurrency on data at server side, as seen in [API Concurrency Control Strategies - Medium](https://medium.com/swlh/api-concurrency-control-strategies-cd546c2cdc16), like the 'ETag' header key (or 'Last-Modified', etc) in web servers, as seen for example [here](https://www.keycdn.com/support/configure-entity-tags-etags) ... maybe later, not really useful here now
* [x] content: cleanup/update to latest standards my custom styles, using [autoprefixer - npmjs](https://www.npmjs.com/package/autoprefixer) and [postcss - npmjs](https://www.npmjs.com/package/postcss), and keep only last 2 versions of most common browsers ... use the online version for example at [autoprefixer - github](https://autoprefixer.github.io/) ... check if be more aggressive, and instead target only 1 last version of most common browsers; note that this task sometimes has to be repeated (like this time) ... ok
* [x] content: update menu (and maybe even the header) to be fixed, or at least sticky (at the top of the page), for example as seen in: [CSS fixed menu - w3schools](https://www.w3schools.com/howto/howto_css_fixed_menu.asp), [CSS sticky nav bar - w3schools](https://www.w3schools.com/howto/howto_js_navbar_sticky.asp), etc; then repeat cleanup fo styles using autoprefixer (online, simpler to use) ... ok, but used the sticky style 'stickyTop' on the whole header instead of custom style 'fixedTop', because here sticky looks better when scrolling page content
* [x] content: check page with Firefox tools for Accessibility ... something related to (not enough) color contrast in footer text; check [here](https://developer.mozilla.org/it/docs/Web/Accessibility/Understanding_WCAG/Perceivable/Color_contrast) for more detailed info on the fix to apply, and use [Color Contrast Checker - WebAIM](https://webaim.org/resources/contrastchecker/) ... ok, changed my custom color 'gray-dark-color' and used it now (contrast of 4.57:1, higher than minimum required for body test: for AA rating is 4.5:1, but not enough for the enhanced ratio AAA rating of 7:1), anyway much better now; no other problems seen by the tool now
* [x] content: try to use (maybe in a branch) [Lightning Design system](https://www.lightningdesignsystem.com/) or other similar, and use Page Header with inside a Menu and other items; see [here](https://www.lightningdesignsystem.com/platforms/heroku/), [example components for React](https://github.com/mashmatrix/react-lightning-design-system), etc for some more info and example usage; note that it's [@salesforce-ux/design-system - npmjs](https://www.npmjs.com/package/@salesforce-ux/design-system) npm and [@salesforce/design-system - pika](https://www.pika.dev/npm/@salesforce/design-system) at pika (to get it from SnowPack) ... maybe later, it's too complex for this example
* [x] content: update my CSS style to use [Flexbox](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Flexible_Box_Layout/Typical_Use_Cases_of_Flexbox) or the newer [Grid layout](https://developer.mozilla.org/en-US/docs/Learn/CSS/CSS_layout/Grids); then tweak/update other parts of styles too, and update templates accordingly ... ok, but fix later styles for 'fixedTop' and 'stickyTop' for the header (fat the moment use normal header style from my css)
* [x] general: update requirements to latest Fastify '^2.14.1' ... ok
* [x] general: update Node.js image in both Dockerfile/s to use latest LTS (at the moment 12.x), more standard ... ok
* [x] general: check why in templates page, fragments doesn't add content into the page ... ok, it was by design: add sample data only in home page (mapped to '/') but not in the template page ('/template'), to see the different behavior; but update related fragments to display something when related data in not present (better user experience)
* [x] general: use new version of my plugin 'fastify-healthcheck' to show even process uptime etc, as soon as its new version will be available ... ok, but instead of '2.2.0', use directly the newer '2.3.0', and enable (as a sample) the flag to expose process uptime (good the same here)
* [x] general: accept [PR#5](https://github.com/smartiniOnGitHub/fastify-example/pull/5) from Snyk, to fix vulnerabilities ... ok, note that now (thanks to the PR) it's available a new npm custom command: `"prepublish": "npm run snyk-protect"` that I can run even manually
* [x] general: add an npm custom command to perform even `npm audit fix` or variants; for more info look at [npm audit - docs - npmjs](https://docs.npmjs.com/cli/audit); of course even in Dockerfiles ... ok, added in both Dockerfile/s, but not in npm custom commands (it's standard enough to write directly if/when needed)
* [x] content: update templates page (and maybe even the static page, but before add some more content to it) with colored sections (maybe with each section using HTML tag 'section') ... ok, but used a section (as a semantic marker for similar content) and add a background color to it, just as a sample
* [x] content: update css styles for lists (ul and li elements), now are much better ... ok, and note that the Firefox Developer Console for this is a great help
* [x] content: update css for section tags to have some more padding, at least on top and bottom; similar to what already done for ul elements ... ok, and tweaked a little even colors and some styles
* [x] content: update footer with a link to Top of the page (an anchor into page header), instead of a link to Home (unnecessary there) ... ok, and added two samples: one with the anchor (with name="top") defined, and another with the trick that link to '#top' in modern browsers works even if related anchor is not present
* [x] content: update the static html page to display similar (but static) content of the template (dynanic) page ... ok
* [x] content: update css to update the styles rule 'nav a:hover, nav ul li a:hover' and 'footer a:hover, footer ul li a:hover' to show more visible links when the cursor is on top of them ... ok, added the style 'text-decoration: underline;' and not 'font-weight:bold;' (because otherwise links will shift a little in the page during the hover)
* [x] content: in top menu bar, add a link to GitHub sources, at [fastify-example - GitHub](https://github.com/smartiniOnGitHub/fastify-example); see [GitHub Logo usage - GitHub](https://github.com/logos) ... so now update css styles for a better vertical alignment of navigation bar links; see [here](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Flexible_Box_Layout/Aligning_Items_in_a_Flex_Container), [here](https://css-tricks.com/snippets/css/a-guide-to-flexbox/), etc ... ok
* [x] general: when running Docker builds at DockerHub (and only there), fix the error: 
```
> snyk protect
Could not load policy. Try running `snyk wizard` to define a Snyk protect policy
```, weird because locally doesn't happen; see [fastify-example - DockerHub](https://hub.docker.com/repository/registry-1.docker.io/smartiniatdocker09/fastify-example/) ... some info [here](https://support.snyk.io/hc/en-us/articles/360003851357-Manage-vulnerability-results-with-the-Snyk-CLI-wizard), [CLI reference - snyk](https://support.snyk.io/hc/en-us/articles/360003812578-CLI-reference), etc ... note that synk policy file is in sources ('.snyk'), but maybe is not copied in the Docker image during the buid, check this ... ok, the problem was snyk policy file ('.snyk') not copied before 'npm install' etc, so in the 'prepublish' (postinstall) phase, snyk still hadn't that file; now all is fine
* [x] content: fix footer links (now in a vertical sequence) ... ok, updated css and perform a small cleanup on it
* [x] content: disable the link for Login (keep it in page but grayed and without the ability to click on it if possible without JavaScript); some info [here](https://css-tricks.com/how-to-disable-links/) ... ok, add custom style and removed the href attribute to its anchor tag; all this even if it's not a recommended practice for links
* [x] general: remove the rule that disables lint rule "eslint no-prototype-builtins" (just added as a workaround after the update to latest 'standard') ... ok, changed code (almost old and unused here JavaScript client code), as suggested [here](https://eslint.org/docs/rules/no-prototype-builtins)
* [x] general: update docs (README; CHANGELOG, etc) ... ok
* [x] general: finalize release ... ok

* [x] general: bump release to '2.6.0' ... ok
* [x] general: fix badges in README: dependencies/devdependencies, vulnerabilities (snyk), add license, etc ... ok, but for now keep dependencies/devDependencies at [david-dm](https://david-dm.org/), check later if use [shields.io](https://shields.io/); last, check later if define variables at the end of README for badge related variables (URLs, etc)
* [x] general: check if/how to protect webapp resources using Fetch Metadata, for example as seen [here](https://web.dev/fetch-metadata/) ... maybe later, and probably best in a real web server (usually as a reverse proxy in front of webapps/api published); but check if something could be done even here with a dedicated plugin
* [x] general: instead of CommonJS modules (typical for Node.js dependencies, using 'require'), try to use ES Modules (or 'ESM'); see [here](https://web.dev/commonjs-larger-bundles/) for more info ... maybe later (minimum with Node.js 14 when LTS) because at the moment many dependencies are not bundled as ESM; use [is-esm - npmjs](https://www.npmjs.com/package/is-esm) to check if a dependency is bundles as ESM, for example try with `npx is-esm fastify`; anyway note that this is more relevant for client side code, and to be optimized it's required a bundler like Snowpack, Rollup, Webpack or other
* [x] content: check if move header to another location (depending on user preferences), like left/right (in vertical); and add a link to expand/contract it (always visible, like the link to Home Page) ... maybe later, interesting but too related to visual appearance
* [x] content: remove my custom styles from pages and change with some good default style, for example [Bulma css](https://bulma.io), see [Getting Started - Bulma](https://bulma.io/documentation/overview/start/), [bulma - npmjs](https://www.npmjs.com/package/bulma), etc; note that it used SASS for CSS compilation/optimization and doesn't use JavaScript ... maybe later
* [x] general: update requirements to latest Fastify '^2.15.0' ... ok
* [x] content: fix css style for navigation list separator, not after last item, as seen for example [here](https://www.blustemy.io/styling-inline-lists-in-css/) ... ok; note that at the moment this is not applied to navigation items in the header (it's defined but commented, so uncomment later if/when needed); removed space ('&nbsp;') at the end of any footer item (not really needed with right css values like now)
* [x] content: use some new css layout techniques as seen [here](https://web.dev/one-line-layouts/) ... maybe later, but very interesting to keep layout code simple and effective
* [x] general: throw if current Node.js version is lower than the expected (minimal) one: Node.js 10 LTS (10.13.0); note that Node.js 8 LTS is out of support now (and of course all previous versions) ... if possible add another check: if current Node.js version is less than 12 LTS (12.13.0) but raise a warning in this case; but with the current version of the plugin this is not possible (I'd need to directly use features exposed by the underlying library), so skip this for now ... ok, but instead of the exception, terminate current process and exit with an error code
* [x] general: update code to use modern Node.js features, as seen in the article [Building an App That Uses All 7 New JavaScript ES2020 Features - Hacker Noon](https://hackernoon.com/building-an-app-that-uses-all-7-new-javascript-es2020-features-6c6t3232) ... maybe later, because those features requires Node.js 14 (in October 2020 should become LTS)
* [x] content: fix css style for header to be really fixed on top ... styles updated, but note that even content style must be updated ... maybe later
* [x] content: check if simplify/improve my layout styles using CSS Grid, as seen in [CSS Grid Layout - MDN](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Grid_Layout), etc ... sure, but maybe later; as seen [here](https://caniuse.com/?search=grid) it's well supported in modern desktop browsers, but not in some mobile browsers, so wait some more time it would be better
* [x] general: use the new release of 'fastify-cloudevents' aligned with v1.0 of the spec (when the plugin will be available); and update all accordingly ... ok, updated but no code changes required
* [x] general: use the new release of 'fastify-cloudevents' aligned with latest changes of Fastify 2.15.0 or higher (when the plugin will be available) ... ok

* [x] general: bump release (patch, so '2.6.1') ... ok
* [x] general: update to latest 'StandardJS', see [ChangeLog - StandardJS](https://standardjs.com/changelog.html), major update (now 16.x) ... ok, and update all other dependencies; all works as before (tested even with latest Node.js 12.x)
* [x] general: add another Dockerfile to make some experiments even with [distroless - Node.js images - GitHub](https://github.com/GoogleContainerTools/distroless/blob/master/examples/nodejs/Dockerfile) base container images (without shell, package managers etc inside, so safer but harder to debug), but check what do to for the 'HEALTHCHECK' directive; use a new 'Dockerfile.distroless'; for some info look [here](https://learnk8s.io/blog/smaller-docker-images), [here](https://medium.com/better-programming/how-to-harden-your-containers-with-distroless-docker-images-c2abd7c71fdb), etc; last, check if move existing Dockerfile/s to a multi-stage image (at least for the normal one, not the Alpine one) ... ok done, but keep it as separate Docker file (added in 'package.json' like others); note that as seen [here](https://github.com/GoogleContainerTools/distroless/issues/183) it seems not so simple to specify 'HEALTHCHECK' directive inside the 'Dockerfile', and instead call an API endpoint from the orchestrator instead (without having to package in the image a script/executable for health checks), see [here](https://medium.com/google-cloud/dockerfile-go-healthchecks-k8s-9a87d5c5b4cb)
* [x] general: update README with the new distroless Docker images (at Docker Hub) ... ok
* [x] general: perform an analysis of performances and vitality on the webapp, as seen for example [here](https://web.dev/vitals-tools/); for more info see [Web Vitals - Web.dev](https://web.dev/vitals/) ... use the online tool [Measure - Web.dev](https://web.dev/measure/) but ensure the webapp is reachable from Google servers (need to listen on '0.0.0.0' and point to its public IP address; ensure the port is open in the firewall of dev machine; for some info about exposing a local dev workstation to Internet (via configuration of the Router if possible, or via some tunneling solution), for example look [here](https://medium.com/botfuel/how-to-expose-a-local-development-server-to-the-internet-c31532d741cc); and maybe install in Chrome even the extension [Web Vitals - Chrome Extensions](https://chrome.google.com/webstore/detail/web-vitals/ahfhijdlegdabablpippeagghigmibma?hl=en) but disable when not needed ... maybe later, using the simplest solution, via Chrome plugin
* [x] general: update CHANGELOG, tag sources, and publish current release ... ok

* [x] general: bump release (minor, so '2.7.0') ... ok
* [x] content: expose a uri (/version) for an api that returns some release related info, like: package name, package version, git hash/tag/branch, etc (from git if available, otherwise from a given local file if available) or use [simple-git - npmjs](https://www.npmjs.com/package/simple-git) if useful or directly 'exec' or 'execFile' promsified [Child processes - Node.js](https://nodejs.org/docs/latest/api/child_process.html); maybe return even the environment (useful to perform smoke tests for example); of course this would expose important info, so in a real app at least protect this with authentication (and an high profile role) to show those info ... do it with all code here (to move when stable in a new plugin) with a feature flag by default enabled; then check if/what move into my library 'check-runtime-env' and related plugin 'fastify-check-runtime-env' ... and later expose only to authenticated users, so could be mapped to '/private/version' or similar ... ok, implemented here even with some data extracted from git (assuming it's installed and available, but if not, errors will be managed and no git data extracted) implemented in the 'utils' source and using some Node.js features promsified and simplified its usage using async/await; all improvements later (as seen in comments in this point), like: require authentication to call it, move implementations in dedicated plugins, move visualization of git data in its own route, etc
* [x] content: move route '/version' under a more general '/info' uri (and later add others here), so: '/info/version' ... ok, but even better ('/info/app'), and later maybe protect all '/info' with authentication (if possible)
* [x] content: add route '/info/scm' to get scm info (but in this case only git is supported) ... ok, and note that async functions must always return a result, so had to ensure e return value; not like in the previous implementation mixed with other values (set as 'undefined' in case of errors, good there but not here because it's the whole response)
* [x] content: for a change password page, check if do it in a standard way, like described [here](https://web.dev/change-password-url/) ... maybe later
* [x] general: check if use [Swagger](https://swagger.io/) via the plugin [fastify-swagger - npmjs](https://www.npmjs.com/package/fastify-swagger), to define API schemas, and to browse them; as a sample look at this sample: [JamesSingleton/my-apartment-server - GitHub](https://github.com/JamesSingleton/my-apartment-server) ... but note that in general, it would be better to use a neutral API definition not tied to a specific product, maybe based on a binary wire format, so that to interact with those API must be used some specific code generator for API clients (specific for the client language used), so developers can't perform changes or tricks there; for example look [Protocol Buffers - Googlee](https://developers.google.com/protocol-buffers), with client libraries for most languages ... maybe later
* [x] general: try to setup some End-to-End (E2E) tests for testing navigation and page interaction, for example with [Cucumber.js - npmjs](https://www.npmjs.com/package/cucumber) and its Gherkin syntax, for info see [Cucumber for JavaScript](https://cucumber.io/docs/installation/javascript/), [Gherkin Reference](https://cucumber.io/docs/gherkin/reference/); and test with [TestCafe - GitHub](https://devexpress.github.io/testcafe/); see even [Getting Started - TestCafe](https://devexpress.github.io/testcafe/documentation/getting-started/), [How to Debug Tests - testCafe](https://devexpress.github.io/testcafe/media/team-blog/how-to-debug-tests-in-testcafe-quick-guide.html), etc; otherwise check if use classical tools like [Selenium](https://www.selenium.dev/) and related products, etc; anyway anything could be installed in a dedicated Docker container, and copy (or mount inside it) tests into it ... maybe later
* [x] content: check if split this repo in multiple subprojects using Workspaces, as seen for example [here](https://blog.heroku.com/building-a-monorepo-with-yarn-2), using yarn 2.x (or npm 7.x, to install manually in Node.js 10.x to 14.x and bundled since Node.js 15.x) ... no, it's much better in a new project with that setup since the beginning: for example a folder for the webapp, another for the api server, another for the web client app, etc; see [Yarn 2 - Migration from Yarn 1](https://yarnpkg.com/getting-started/migration), [Working with Workspaces in npm 7](https://docs.npmjs.com/cli/v7/using-npm/workspaces), [here](https://dev.to/limal/simplify-your-monorepo-with-npm-7-workspaces-5gmj), etc; but pay attention because all must be managed in a different way (even to version subcomponents, if/when needed)
* [x] general: improve Docker images, following even best practices seen in [10 best practices to containerize Node.js web applications with Docker | Snyk Blog](https://snyk.io/blog/10-best-practices-to-containerize-nodejs-web-applications-with-docker/) ... ok, but not in default image (so keep it even for development purposes), and note that here I don't version npm lockfile ('package-lock.json'), so some recommendations aren't appliable here
* [x] general: add in main folder a file '.nvmrc' with inside the desired Node.js version (put in that file the full version extracted from `node --version` with or without the 'v' prefix, or even a generic major version like '10'), so anyone that uses [nvm](https://github.com/nvm-sh/nvm) can switch to the right version directly with `nvm use` or `nvm install` etc (but note that the switch won't be automatic, unluckily); remember to **not** exclude that file (so do not add it in the '.gitignore', but in some cases it could be useful to exclude it); of course all this is optional, but could be useful; last, when project requirements change Node.js version, remember to update even in that file ... maybe later
* [x] content: try to use a classless css framework like [sakura.css - npmjs](https://www.npmjs.com/package/sakura.css) and to reset css properties [normalize.css - npmjs](https://www.npmjs.com/package/normalize.css); for example look at a sample article [here](https://www.skypack.dev/blog/2021/03/the-best-classless-css-frameworks-in-2021/) ... maybe later, and for new pages
* [x] general: add TAP config file ('.taprc') and simplify related npm custom commands ... ok
* [x] general: check if remove 'simple-get' and use 'undici' instead ... maybe later
* [x] general: generate sources documentation with JSDoc, then add npm custom command to generate docs, but here not in the folder 'docs/' (already existing and with other content, but in the 'out/' folder (already excluded from version control) ... removed ESDoc config file (no more useful), '.esdoc.json' and added the one for JSDoc, '.jsdoc.json' ... ok, all done
* [x] general: use the new release of 'fastify-cloudevents' aligned with v1.0.1 of the spec, and aligned with latest changes of Fastify 2.15.3 or higher (but 2.x); and update all accordingly ... test all now (without and with NATS client enabled) ... ok, all works as before
* [x] content: as a sample, provide a route to serve SPA (all client-side UI) via [Svelte - Home](https://svelte.dev/), [Svelte - npmjs](https://www.npmjs.com/package/svelte); it's interesting because it's a compiler that takes your declarative components and converts them into efficient JavaScript that surgically updates the DOM, and simplify the creation/usage of components; see [Quickstart - Svelte](https://svelte.dev/blog/the-easiest-way-to-get-started); note that Svelte doesn't need other runtime dependencies, but only dev dependencies (very good) for it and the chosen bundler; a sample webapp with Fastify and Svelte is [hundred-players - GitHub](https://github.com/admataz/hundred-players) ... another approach (better instead of add other runtime dependencies, but in this case this is not necessary) could be to develop and deploy that app in its own repository (and dependencies, etc), and link here from a dedicated SPA Index page ('/spa') made with current template system, that link both proposed choices: '/spa/svelte-static' that uses Fastify plugin [fastify-static - npmjs](https://www.npmjs.com/package/fastify-static) to map his distribution files, and '/spa/svelte-proxy' that uses Fastify plugin [fastify-http-proxy - npmjs](https://www.npmjs.com/package/fastify-http-proxy) or [fastify-reply-from](https://www.npmjs.com/package/fastify-reply-from) to proxy its running app (to forward requests to configured endpoint, like 'http://localhost:5000' of the served webapp); of course other solution could be used instead (other proxy, etc), but without integrating that app here, recommended ... maybe later, it's very interesting but it requires a real app
* [x] content: to use Svelte without a bundler (like Webpack, Rollup, etc) and directly use ES modules (ESM), try to use [Snowpack - npmjs](https://www.npmjs.com/package/snowpack); for example using [Svelvet - npmjs](https://www.npmjs.com/package/svelvet); see even: [Svelvet - GitHub](https://github.com/jakedeichert/svelvet), [Snowpack - Home](https://www.snowpack.dev/); note that this enable to target only ES Modules (supported by all modern browsers, since some time) and maybe write client-side JavaScript using ES2019 or ES2020 syntax (very cool, readable and useful to simplify source code) ... note that since Snowpack 2 things have much improved, as seen [here](https://www.snowpack.dev/posts/2020-05-26-snowpack-2-0-release); even more since since Snowpack 3; Svelvet now has been discontinued; last, SvelteKit (new framework for Svelte apps) uses Vite instead of Snowpack ... maybe later, it's very interesting but it requires a real app
* [x] content: to deliver one/more modern SPA, there are some dependencies (only devDependencies) that must be present at build time, so in this case probably it makes sense to update Dockerfile to become multistage: initial stage with all dependencies installed, make all builds (maybe optimized for production), tests, etc; and then another stage to install only non dev dependencies (production) get all content built and use it; or otherwise split all and setup a Dockerfile for build, and another for run (but attention to mistakes) ... maybe later
* [x] content: update [EJS](https://github.com/mde/ejs) to latest 3.x (at the moment 3.0.1) and ensure all works ... but note that at the moment I get an error, probably there is something to fix/update in Fastify plugin (point-of-view), the error is: "you may want to try EJS-Lint:\nhttps://github.com/RyanZim/EJS-Lint\nOr, if you meant to create an async function, pass `async: true` as an option.\n    at new Function (<anonymous>)\n    at Template.compile (/home/sandro/work/prove/fastify-example/node_modules/ejs/lib/ejs.js:626:12)\n etc"; check if Fastify guys for a fix, but maybe for next major release of point-of-view plugin ... maybe later, when this webapp will be implemented on top of Fastify 3.x
* [x] general: enable dependabot, for automatic PR on dependencies updates (like in Fastify); then add '.dependabot' in '.npmignore' to exclude it ... maybe later
* [x] general: setup [GitHub Actions](https://help.github.com/en/categories/automating-your-workflow-with-github-actions) as a build (CI) environment, for example by using [setup-node - actions](https://github.com/actions/setup-node); when available; some info even in this [article](https://itnext.io/simplify-your-npm-publish-workflow-using-github-actions-691249bc7e59) ... maybe later
* [x] general: to debug inside Visual Studio Code (VSCode), follow its guide [Debug Node.js Apps using Visual Studio Code - VSCode](https://code.visualstudio.com/docs/nodejs/nodejs-debugging), very useful for example to debug TAP tests ... ok but I had to run a "JavaScript Debug Terminal" and then run "npm run test:unit:debug" (and of course set some breakpoints in sources)
* [x] general: update Node-Tap ('tap') to latest release (major update to '^15.0.0'), released today ... ok, but I had to update/simplify its config file '.taprc' to remove some option, seen with `npx tap --dump-config` and an empty '.taprc' config file, and even with `npx tap -h`; then commented some values (different than default value) that could be useful to enable later
* [x] content: add route '/info/os' to get some info about the operating system (OS) ... ok, but note that some sensitive informations (in terms of security) will be exposed, so in a real app disable it by default or protect with authentication; but commented the output of all env variables, check later if expose only it but in a dedicated endpoint ('/info/env'), maybe filtered with a regular expression (regexp) if given
* [x] general: add Fastify plugin [fastify-rate-limit](https://github.com/fastify/fastify-rate-limit), and use it (with different, lower values) for some of new routes implemented in this release; disable it with a dedicated feature flag (and ensure when disabled that all works as before) ... maybe later
* [x] content: expose a uri '/info/all' (or '/info/general', or at least '/info') for an api that returns some info on the current process grouped by type, like: process (pid, hostname, Node.js version, process uptime, Node.js environment, etc), OS (name, release, host uptime, maybe even env vars, etc), frameworks (release, list of plugins loaded if available, etc); of course this would expose important info, so in a real app at least protect this with authentication/token and maybe a filter on source CIDR (IP/mask) and an high profile role to show those info ... do it with all code here (to move later in a new plugin, with a feature flag by default enabled); then check if/what move into my library 'check-runtime-env' and related plugin 'fastify-check-runtime-env'; later expose only to authenticate users, so could be mapped to '/private/info' or similar ... ok, moved all related to info routes in its own source ('route-info')
* [x] content: refactor the logic used by all info routes, to simplify reuse ... ok, performed a refactor of logic in private helper functions; then, to ensure async routes always return a value, I wrapped the code inside helper functions in a try/catch block, and decided to return an object, as either: `{ err , data }` where only the first or the second item is not null
* [x] content: refactor 'route-info' source to simplify the usage of the either return value from helper functions, and related creation and data extraction; but do not create a class for Either here (maybe later) ... ok, created an utility function 'getFromEither' in the 'utils' source
* [x] content: update source docs, then re-generate it ... ok but here it doesn't generate so much docs (too few comments in sources currently)
* [x] general: update CHANGELOG, tag sources, and publish current release ... ok

* [x] general: bump new release (just started) ... ok
* [x] general: check if use [Prisma](https://www.prisma.io/) to manage persistence to/from databases ... maybe later (even if it seems very interesting), but mainly to keep this example self-contained and simple
* [x] general: check if implement some best practices to secure code execution here, as seen [here](https://snyk.io/blog/5-ways-to-prevent-code-injection-in-javascript-and-node-js/), even by using [eslint-plugin-security-node - npmjs](https://www.npmjs.com/package/eslint-plugin-security-node) ... maybe later, because here I'm using StandardJS and not ESLint directly
* [x] general: update all dependencies to latest ... ok
* [x] general: since Node.js 12.7.0 it's possible to let it be aware of resource limit when running inside a Container ... better, do it when previous LTS (10) goes out of active support; in the meantime update Docker images to use that newer version (better suited for usage in containers) ... see [The Difference Between Node.js 10 LTS and Node.js 12 LTS - Node.js Blog](https://nodejs.org/en/blog/uncategorized/10-lts-to-12-lts/) for relevant changes ... ok
* [x] general: since 01 May 2021, Node.js 10 is in End-of-Life (EoL), so now update requirements to Node.js 12 LTS (12.13.0) and so output ES2019/ES10 or ES2020/ES11 ... ok; as a reference, if/when using TypeScript here, as seen at [Recommended Node TSConfig settings - TypeScript wiki](https://github.com/microsoft/TypeScript/wiki/Node-Target-Mapping), [here](https://stackoverflow.com/questions/59787574/typescript-tsconfig-settings-for-node-js-12), etc, set target output to ES2019 and target library as ES2020 because not syntax but many functions of it are already implemented since that version; for now keep commonjs modules
* [x] general: for some general info and examples about JWT, JWT Authentication using Node.js (so at server side), look even: [here](https://www.youtube.com/watch?v=7Q17ubqLfaM), [here](https://www.youtube.com/watch?v=mbsmsi7l3r4) with related repo [here](https://github.com/WebDevSimplified/JWT-Authentication), [here](https://www.youtube.com/watch?v=Ud5xKCYQTjM), etc ... ok; for info about how to manage user roles in Node.js (so at server side), look even [here](https://www.youtube.com/watch?v=jI4K7L-LI58), etc
* [x] general: to simplify manual use/debug of API in the DEV environment, if using Visual Studio Code (VSCode), install the [REST Client](https://marketplace.visualstudio.com/items?itemName=humao.rest-client) extension, and write API calls in one or more files '.http' or '.rest', then execute related callas directly from that file (open in the editor) and maybe save results, use/convert in cURL format, etc ... ok, very useful; see an example usage even [here](https://blog.bitsrc.io/vs-codes-rest-client-plugin-is-all-you-need-to-make-api-calls-e9e95fcfd85a); of course related files should be added to version control, but excluded from packaging
* [x] general: check if publish this app at [Heroku](https://www.heroku.com/) but using Docker containers, some info even [here](https://dev.to/analythium/deploying-shiny-apps-to-heroku-with-docker-and-github-actions-2687); then add a bagde in README to point to it ... maybe later
* [x] general: add on 'Open in VS Code' badge in the README, as seen [here](https://code.visualstudio.com/updates/v1_58#_open-in-vs-code-badge) ... maybe later
* [x] general: update Dockerfile to use the lts-slim image (so 'node:lts-slim') instead of the usual lts (bigger) ... ok, then perform a scan to search for (less) vulnerabilities (maybe zero if possible); for more info look at [Node.js - DockerHub](https://hub.docker.com/_/node)
* [x] general: later update to Node.js 14 LTS (14.15.0) and so output ES2020/ES11 or ES2021/ES12 (but partial support for it) ... maybe later
* [x] general: after upgrading to Node.js 14.x LTS, check if expose sources as ES Modules (ESM), by default (so in 'package.json' add: `"type": "module"`, and rename non-esm sources from '.js' to '.cjs'); as a sample look [here](https://github.com/lmammino/univ), and in many other places, like this great example: [fastify-101 - delvedor - github](https://github.com/delvedor/fastify-101); but first ensure all Fastify ecosystem is compatible (and my plugins), TAP tests are compatible, etc ... maybe later
* [x] general: after the update of requirements to Node.js 14 LTS (or 16 LTS, or at least 12 LTS), migrate to ESM modules, so: update 'package.json' with `"type": "module",` and related settings, then update TypeScript output to be 'es2020' with support for ES Modules (esm), and update all import statements using esm syntax, for example:
```
// import assert from 'node:assert'
import { strict as assert } from 'node:assert'
import tap, { Test } from 'tap'
```
and remove eslint rule to disable @typescript-eslint/no-var-requires, fix all other imports using Node.js require statement, rename tap tests from 'test' to 'tap.test', import tap type for Test, to be able to update '(t)' to '(t: Test)', etc ... maybe later
* [x] general: after the update to Node.js 14 LTS (14.15.0), and so output ES2020/ES11, export all as native ES Modules (ESM), important; for better TypeScript settings with ESM and CommonJS look even [here](https://stackoverflow.com/questions/61305578/what-typescript-configuration-produces-output-closest-to-node-js-14-capabilities/61305579#61305579), etc ... maybe later
* [x] general: tests made in TypeScript: use the Fastify server configured in its own source, and ensure routes defined works in the right way (via injection) ... maybe later
* [x] general: pay attention to the vulnerability found in current 'ejs' version; need to upgrade to latest version ... maybe later, because related plugin ('point-of-view') requires Fastify 3.x, sorry for that; anyway for a sample application like this is not a big problem
* [x] general: update dependencies to latest packages compatible with current Node.js version (and no ES Modules, for now) and Fastify 2.x ... ok
* [x] content: instead of do a rate limiting of some routes (like all the info ones), check if use a cache (but simple: in memory or in a file, to not introduce other dependencies) and refresh every n seconds (configurable via a specific env var); otherwise check for a Fastify plugin for a cache ... maybe later
* [x] general: split Fastify server configuration in its own source ('build-server' or similar), to be able to reuse it even in unit tests ... ok, done even by following the example [fastify-101 - delvedor - github](https://github.com/delvedor/fastify-101), but in this case without ESM and without async
* [x] general: add some tests after the split of Fastify server and the App ... ok, and replicated some optional additions even in test source, like: load settings from environment, load settings from constants, etc
* [x] general: prepare to publish the release (update CHANGELOG and release date, README if needed, etc) ... ok

* [x] general: after publishing a release (and tag sources), manually trigger related Docker images at DockerHub, if still possible in the free plan ... no, it's no more possible neither to trigger builds manually at Docker Hub; so I deleted all previous images and keep only 'latest' and related variants, and last one from a tag (but not today tag, only the previous one), it's really time to change; sorry to keep there only outdated images (maybe later remove them)
* [x] general: tag new release; then manually rebuild Docker images for tags at Docker Hub, then check if even for normal builds ... no
* [x] general: add a Security section in the README, because current release of the application has some vulnerabilities; with Fastify 2.x the template engine uses an old version of 'ejs' (via related Fastify plugin) but it's updated/fixed only in Fastify 3.x ... ok, section added
* [x] general: to improve interaction with ES Modules (ESM), look even [here](https://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c) ... maybe later
* [x] general: create a maintenance branch '2.x' for Fastify 2.x ... ok

* [x] general: bump release (in package.json, README, CHANGELOG and maybe in other places) ... ok, bump to '3.0.0' in the new branch 'update-to-fastify-3', to merge later into 'master'
* [x] general: update to Fastify 3.x (released 2020-07-07) and related (compatible) plugins; but a lot of changes will be needed, so start it in a feature branch; see [Fastify - Releases - GitHub](https://github.com/fastify/fastify/releases) and related breaking changes from v2 [here](https://github.com/fastify/fastify/releases/tag/v3.0.0); maybe in first release stay with '3.0.0' and then update to a later 3.x; remember to empty the section on Security in the README as soon as no known vulnerabilities are found (with this new version) ... ok, work started in the new branch 'update-to-fastify-3', to merge later into 'master'
* [x] general: make all work again with Fastify 3.x (but no ES Modules for now); for related breaking changes from v2 [here](https://github.com/fastify/fastify/releases/tag/v3.0.0); for now, disable some of my plugins not yet compatible (like:  'fastify-check-runtime-env', 'fastify-cloudevents', 'fastify-nats-client', 'fastify-webhook') and re-add later ... ok, overall it seems to work, but EJS templates not and breaking changes still to verify (and update code if/where needed); fix in another point (and wait for merge at least until that)
* [x] general: fix EJS templates working; for info look at [EJS - Home](https://ejs.co/), and even [How to use EJS to template your Node.js application - LogRocket Blog](https://blog.logrocket.com/how-to-use-ejs-template-node-js-application/), [How To Use EJS to Template Your Node Application | DigitalOcean](https://www.digitalocean.com/community/tutorials/how-to-use-ejs-to-template-your-node-application), [NodeJs Express EJS Layouts and Partials - Raddy](https://www.raddy.dev/blog/nodejs-express-layouts-and-partials/), etc ... ok, but note that EJS layout is set in plugin registration, so unless more instances will be registered (it could be done if needed), all EJS pages will have that layout; later check if it could be set at route level instead; so for now most EJS pages have been moved to be fragments (and not a full page) just to avoid tags duplication in final output page, but some are kept as full page, if useful as an example; note that to relead the server when started in DEV mode (`npm run start:dev`) a JavaScript source must be saved (ejs pages for example aren't considered for this)
* [x] general: update CHANGELOG to add compatibility to latest EJS (currently 3.1.6) and rework its pages, and use a general layout so that each ejs page will use it, but so pay attention to simplify each other ejs page to be a fragment (and not a complete page) to not duplicate tags in final output page ... ok
* [x] general: merge this branch into master, with a PR ... ok, is will be done ASAP
* [x] general: continue the work for first release compatible with Fastify 3.x (a little better: '^3.3.0') and Node.js 12 LTS, now merged into the master branch ... ok
* [x] general: fix badges in README: dependencies/devdependencies, check if use [shields.io](https://shields.io/); last, check later if define variables at the end of README for badge related variables (URLs, etc) ... no, it's simpler to remove them (related site seems no more working and alternatives are too complex to setup and use)
* [x] general: re-enable my plugins once compatible with fastify 3.x ... ok, re-enabled 'fastify-check-runtime-env', 'fastify-webhook'), others later
* [x] general: delete related project at DockerHub (so all, even images, tags, build automation, etc) because now is outdated (without a Pro subscription), with security vulnerabilities inside, etc ... ok, and updated related doc file 'docs/Docker-publish.md'


---------------

